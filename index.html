<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PHUCNGUYEN X MUSIC REMIX</title>
<style>
body {
    margin:0; padding:0;
    height:100vh; background-color:#000;
    font-family:Arial,sans-serif;
    color:#fff; overflow:hidden;
}
#mainContent {
    display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;
}
h1 {
    font-size:2.5rem; text-align:center; margin-bottom:20px;
    border:2px solid #fff; padding:10px 20px; border-radius:20px;
    box-shadow:0 0 15px #ff4b2b,0 0 30px #00f260;
}
button {
    margin:5px; padding:15px 40px; font-size:18px;
    border:none; border-radius:15px; cursor:pointer;
    background: linear-gradient(45deg, #ff416c, #ff4b2b);
    color:#fff; font-weight:bold;
    box-shadow:0 4px 12px rgba(255,75,43,0.5);
    transition: all 0.3s ease;
    position: relative;
}
button:hover { transform: scale(1.05); box-shadow:0 6px 18px rgba(255,75,43,0.8);}
.playing { background: linear-gradient(45deg,#00f260,#0575e6); box-shadow:0 6px 20px rgba(0,242,96,0.8); }
canvas { position:absolute; bottom:0; width:100%; height:100%; z-index:0; display:block;}
</style>
</head>
<body>

<div id="mainContent">
    <h1>PHUCNGUYEN X MUSIC REMIX</h1>
    <button id="btnFellDown">FELL DOWN</button>
    <button id="btnTrackMaker">TRACKMAKER</button>
    <button id="btnDJBar">DJ BAR</button>
    <button id="btnFullJ97">FULL J97</button>
    <button id="btnPhonk">PHONK</button>
    <canvas id="waveCanvas"></canvas>
</div>

<script>
// --- Audio & Visualizer ---
const tracks = [
    {name:'FELL DOWN', url:'https://files.catbox.moe/q1ayew.mp3'},
    {name:'TRACKMAKER', url:'https://files.catbox.moe/h40ruv.mp3'},
    {name:'DJ BAR', url:'https://files.catbox.moe/2exit9.mp3'},
    {name:'FULL J97', url:'https://files.catbox.moe/7xsp68.mp3'},
    {name:'PHONK', url:'https://files.catbox.moe/4ua8l7.mp3'}
];

const buttons = [
    document.getElementById('btnFellDown'),
    document.getElementById('btnTrackMaker'),
    document.getElementById('btnDJBar'),
    document.getElementById('btnFullJ97'),
    document.getElementById('btnPhonk')
];

const canvas = document.getElementById('waveCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let audioCtx=null, analyser=null, source=null, gainNode=null;
let currentAudio=null, currentIndex=0, animationId=null;

function stopAudio(){
    if(currentAudio){ currentAudio.pause(); currentAudio.src=''; }
    if(source) source.disconnect();
    if(gainNode) gainNode.disconnect();
    if(analyser) analyser.disconnect();
    if(animationId) cancelAnimationFrame(animationId);
    buttons.forEach(b=>b.classList.remove('playing'));
}

function playTrack(index){
    stopAudio();
    const track = tracks[index];
    currentAudio = new Audio(track.url);
    currentAudio.crossOrigin="anonymous";
    currentAudio.load();

    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if(audioCtx.state==='suspended') audioCtx.resume();

    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 128;
    analyser.smoothingTimeConstant = 0.7;

    source = audioCtx.createMediaElementSource(currentAudio);
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 1;

    source.connect(gainNode);
    gainNode.connect(analyser);
    analyser.connect(audioCtx.destination);

    currentAudio.play();
    buttons[index].classList.add('playing');
    currentIndex=index;

    currentAudio.onended = ()=> playTrack((currentIndex+1)%tracks.length);

    visualize();
}

buttons.forEach((b,i)=> b.addEventListener('click',()=> playTrack(i)));

// --- Visualizer ---
function visualize(){
    if(!analyser) return;
    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    function draw(){
        analyser.getByteFrequencyData(dataArray);
        ctx.clearRect(0,0,canvas.width,canvas.height);

        // Gradient nền
        const gradient = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
        gradient.addColorStop(0,'#050505');
        gradient.addColorStop(1,'#000000');
        ctx.fillStyle=gradient;
        ctx.fillRect(0,0,canvas.width,canvas.height);

        const barWidth = (canvas.width / bufferLength) * 2;
        let x = 0;

        for(let i=0;i<bufferLength;i++){
            const barHeight = dataArray[i]/255 * canvas.height * 0.6;
            ctx.fillStyle = `hsl(${i*3},100%,50%)`;
            ctx.shadowBlur = 25;
            ctx.shadowColor = ctx.fillStyle;
            ctx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
            x += barWidth + 1;
        }

        animationId = requestAnimationFrame(draw);
    }
    draw();
}

// --- Resume AudioContext khi tab active lại ---
document.addEventListener('visibilitychange', ()=>{
    if(document.visibilityState==='visible'){
        if(audioCtx && audioCtx.state==='suspended') audioCtx.resume();
    }
});

window.addEventListener('resize', ()=>{
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
});
</script>

</body>
</html>
